package co.datainsider.jobworker.util

import co.datainsider.jobscheduler.util
import co.datainsider.jobworker.repository.reader.lazada.LazadaReader
import com.fasterxml.jackson.databind.JsonNode
import com.twitter.inject.Test
import co.datainsider.schema.domain.column.Column
import datainsider.client.exception.InternalError

import scala.jdk.CollectionConverters.asScalaIteratorConverter

/**
  * created 2023-04-07 3:17 PM
  *
  * @author tvc12 - Thien Vi
  */
class LazadaUtilsTest extends Test {
  test("get order columns") {
    val json =
      """
[{"treeId":76651,"data":[],"children":[],"name":"branch_number","id":96,"type":"String","required":true,"desc":"(For Thailand only) The tax branch code for corporate customers, provided by the customer when placing the order."},{"treeId":76652,"data":[],"children":[],"name":"tax_code","id":96,"type":"String","required":true,"desc":"(For Thailand and Vietnam only) The customer's VAT tax code, provided by the customer when placing the order."},{"treeId":76653,"data":[],"children":[],"name":"extra_attributes","id":96,"type":"String","required":true,"desc":"Extra attributes which were passed to the Seller Center on getMarketPlaceOrders call."},{"treeId":76654,"data":[],"children":[],"name":"address_updated_at","id":96,"type":"String","required":true,"desc":"Address updated at"},{"treeId":76655,"data":[],"children":[],"name":"shipping_fee","id":96,"type":"String","required":true,"desc":"Total shipping fee for this order."},{"treeId":76656,"data":[],"children":[],"name":"customer_first_name","id":96,"type":"String","required":true,"desc":"Customer first name"},{"treeId":76657,"data":[],"children":[],"name":"payment_method","id":96,"type":"String","required":true,"desc":"The method of the payment. For details, see Payment method options."},{"treeId":76658,"data":[],"children":[],"name":"statuses","id":96,"type":"String[]","required":true,"desc":"An array of unique status of the items in the order. You can find all of the different status codes in the response example."},{"treeId":76659,"data":[],"children":[],"name":"remarks","id":96,"type":"String","required":true,"desc":"Remarks"},{"treeId":76660,"data":[],"children":[],"name":"order_number","id":96,"type":"String","required":true,"desc":"Represents the order ID"},{"treeId":76661,"data":[],"children":[],"name":"order_id","id":96,"type":"String","required":true,"desc":"Represents the order ID"},{"treeId":76662,"data":[],"children":[],"name":"voucher","id":96,"type":"String","required":true,"desc":"Total voucher for this order."},{"treeId":76663,"data":[],"children":[],"name":"national_registration_number","id":96,"type":"String","required":true,"desc":"National registration number. Required in some countries."},{"treeId":76664,"data":[],"children":[],"name":"promised_shipping_times","id":96,"type":"String","required":true,"desc":"Target shipping time for the soonest order item if they are available."},{"treeId":76665,"data":[],"children":[],"name":"items_count","id":96,"type":"Number","required":true,"desc":"Number of items in order."},{"treeId":76666,"data":[],"children":[],"name":"voucher_platform","id":96,"type":"String","required":false,"desc":"The voucher that is issued by Lazada"},{"treeId":76667,"data":[],"children":[],"name":"voucher_seller","id":96,"type":"String","required":false,"desc":"The voucher that is issued by the seller"},{"treeId":76668,"data":[],"children":[],"name":"created_at","id":96,"type":"String","required":true,"desc":"Date and time when the order was placed."},{"treeId":76669,"data":[],"children":[],"name":"price","id":96,"type":"String","required":true,"desc":"Total amount for this order.Not the final transaction price of the order, excluding voucher and shipping_fee"},{"treeId":76670,"data":[],"children":[{"treeId":76671,"data":[],"children":[],"name":"address1","id":96,"type":"String","required":true,"desc":"Detailed address"},{"treeId":76672,"data":[],"children":[],"name":"phone2","id":96,"type":"String","required":true,"desc":"Backup phone number"},{"treeId":76673,"data":[],"children":[],"name":"first_name","id":96,"type":"String","required":true,"desc":"Customer first name"},{"treeId":76674,"data":[],"children":[],"name":"phone","id":96,"type":"String","required":true,"desc":"Phone number"},{"treeId":76675,"data":[],"children":[],"name":"address5","id":96,"type":"String","required":true,"desc":"Third-level address"},{"treeId":76676,"data":[],"children":[],"name":"post_code","id":96,"type":"String","required":true,"desc":"Post code; Note: This value will not be used in Lazada ID"},{"treeId":76677,"data":[],"children":[],"name":"address4","id":96,"type":"String","required":true,"desc":"City name"},{"treeId":76678,"data":[],"children":[],"name":"last_name","id":96,"type":"String","required":true,"desc":"Customer last name"},{"treeId":76679,"data":[],"children":[],"name":"country","id":96,"type":"String","required":true,"desc":"Country"},{"treeId":76680,"data":[],"children":[],"name":"address3","id":96,"type":"String","required":true,"desc":"State name"},{"treeId":76681,"data":[],"children":[],"name":"address2","id":96,"type":"String","required":true,"desc":"Not used for now"},{"treeId":76682,"data":[],"children":[],"name":"city","id":96,"type":"String","required":true,"desc":"City name"}],"name":"address_billing","id":96,"type":"Object","required":true,"desc":"Node that contains additional nodes, which makes up the billing address: FirstName, LastName, Phone, Phone2, Address1, Address2, City, PostCode, and Country."},{"treeId":76683,"data":[],"children":[],"name":"warehouse_code","id":96,"type":"String","required":false,"desc":"Warehouse Code of multi-wh sellers"},{"treeId":76684,"data":[],"children":[],"name":"shipping_fee_original","id":96,"type":"String","required":false,"desc":"the original shipping fee which are supposed to be charged to the customer, before any type of shipping fee promotion"},{"treeId":76685,"data":[],"children":[],"name":"shipping_fee_discount_seller","id":96,"type":"String","required":false,"desc":"shipping fee discount from seller"},{"treeId":76686,"data":[],"children":[],"name":"shipping_fee_discount_platform","id":96,"type":"String","required":false,"desc":"shipping fee discount from platform"},{"treeId":76687,"data":[],"children":[{"treeId":76688,"data":[],"children":[],"name":"address1","id":96,"type":"String","required":true,"desc":"Detailed address"},{"treeId":76689,"data":[],"children":[],"name":"phone2","id":96,"type":"String","required":true,"desc":"Backup phone number"},{"treeId":76690,"data":[],"children":[],"name":"first_name","id":96,"type":"String","required":true,"desc":"Customer first name"},{"treeId":76691,"data":[],"children":[],"name":"phone","id":96,"type":"String","required":true,"desc":"Phone number"},{"treeId":76692,"data":[],"children":[],"name":"address5","id":96,"type":"String","required":true,"desc":"Third-level address"},{"treeId":76693,"data":[],"children":[],"name":"post_code","id":96,"type":"String","required":true,"desc":"Post code; Note: This value will not be used in Lazada ID"},{"treeId":76694,"data":[],"children":[],"name":"address4","id":96,"type":"String","required":true,"desc":"City name"},{"treeId":76695,"data":[],"children":[],"name":"last_name","id":96,"type":"String","required":true,"desc":"Customer last name"},{"treeId":76696,"data":[],"children":[],"name":"country","id":96,"type":"String","required":true,"desc":"Country"},{"treeId":76697,"data":[],"children":[],"name":"address3","id":96,"type":"String","required":true,"desc":"State name"},{"treeId":76698,"data":[],"children":[],"name":"address2","id":96,"type":"String","required":true,"desc":"Not used for now"},{"treeId":76699,"data":[],"children":[],"name":"city","id":96,"type":"String","required":true,"desc":"City name"}],"name":"address_shipping","id":96,"type":"Object","required":true,"desc":"Node that contains additional nodes, which makes up the shipping address: FirstName, LastName, Phone, Phone2, Address1, Address2, City, PostCode, and Country."},{"treeId":76700,"data":[],"children":[],"name":"customer_last_name","id":96,"type":"String","required":true,"desc":"Empty for now. See cutomer_first_name. "},{"treeId":76701,"data":[],"children":[],"name":"gift_option","id":96,"type":"String","required":true,"desc":"1 if item is a gift, and 0 if it is not."},{"treeId":76702,"data":[],"children":[],"name":"voucher_code","id":96,"type":"String","required":true,"desc":"The returned value is Voucher id"},{"treeId":76703,"data":[],"children":[],"name":"updated_at","id":96,"type":"String","required":true,"desc":"Date and time of the last change to the order."},{"treeId":76704,"data":[],"children":[],"name":"delivery_info","id":96,"type":"String","required":true,"desc":"Delivery information"},{"treeId":76705,"data":[],"children":[],"name":"gift_message","id":96,"type":"String","required":true,"desc":"Gift message as specified by the customer."}]/or country.\t"},{"sample":"Dada","type":"string","name":"district","key":"bczGkjr","description":"The district of the recipient's address. Whether there is a district will depend on the region and/or country.\t"},{"sample":"Asajaya","type":"string","name":"city","key":"PFZsWer","description":"The city of the recipient's address. Whether there is a city will depend on the region and/or country.\t"},{"sample":"Sarawak","type":"string","name":"state","key":"hxpEfxa","description":"The state/province of the recipient's address. Whether there is a state/province will depend on the region and/or country.\t"},{"sample":"MY","type":"string","name":"region","key":"EGxnmDG","description":"The two-digit code representing the region of the Recipient.\t"},{"sample":"40009","type":"string","name":"zipcode","key":"dMTMSfF","description":"Recipient's postal code.\t"},{"sample":"C-15-14 BLOK C JALAN 30/146, Asajaya, 40009, Sarawak","type":"string","name":"full_address","key":"EMftjDb","description":"The full address of the recipient, including country, state, even street, and etc.\t"}],"name":"recipient_address"},{"sample":"2.0","type":"float","name":"actual_shipping_fee","key":"PjTcxDG","description":"The actual shipping fee of the order if available from external logistics partners.\t"},{"sample":"false","type":"boolean","name":"goods_to_declare","key":"YXXDApd","description":"Only work for cross-border order.This value indicates whether the order contains goods that are required to declare at customs. \"T\" means true and it will mark as \"T\" on the shipping label; \"F\" means false and it will mark as \"P\" on the shipping label. This value is accurate ONLY AFTER the order trackingNo is generated, please capture this value AFTER your retrieve the trackingNo.\t"},{"sample":"haha","type":"string","name":"note","key":"KKiwdys","description":"The note seller made for own reference.\t"},{"sample":"1608103685","type":"timestamp","name":"note_update_time","key":"ReiFtFG","description":"Update time for the note.\t"},{"description":"This object contains the detailed breakdown for the result of this API call.\t","sample":"","key":"Sycrznr","type":"object[]","children":[{"sample":"2600144043","type":"int","name":"item_id","key":"hPEtaFk","description":"Shopee's unique identifier for an item."},{"sample":"backpack","type":"string","name":"item_name","key":"eRptKYe","description":"The name of the item."},{"sample":"sku","type":"string","name":"item_sku","key":"JXrjbnH","description":" A item SKU (stock keeping unit) is an identifier defined by a seller, sometimes called parent SKU. Item SKU can be assigned to an item in Shopee Listings.\t"},{"sample":"105933822990","type":"int","name":"model_id","key":"FjiFdnQ","description":"ID of the model that belongs to the same item.\t"},{"sample":"Grey blue 40*60cm","type":"string","name":"model_name","key":"aQEJxmp","description":"Name of the model that belongs to the same item. A seller can offer models of the same item. For example, the seller could create a fixed-priced listing for a t-shirt design and offer the shirt in different colors and sizes. In this case, each color and size combination is a separate model. Each model can have a different quantity and price.\t"},{"sample":"DMM1952804068","type":"string","name":"model_sku","key":"kDpaRTP","description":"A model SKU (stock keeping unit) is an identifier defined by a seller. It is only intended for the seller's use. Many sellers assign a SKU to an item of a specific type, size, and color, which are models of one item in Shopee Listings.\t"},{"sample":"1","type":"int","name":"model_quantity_purchased","key":"PdXaBbF","description":"The number of identical items purchased at the same time by the same buyer from one listing/item.\t"},{"sample":"1000.0","type":"float","name":"model_original_price","key":"DmfrGeY","description":"The original price of the item in the listing currency.\t"},{"sample":"800.0","type":"float","name":"model_discounted_price","key":"bHxkeCE","description":"The after-discount price of the item in the listing currency. If there is no discount, this value will be same as that of model_original_price. In case of bundle deal item, this value will return 0 as by design bundle deal discount will not be breakdown to item/model level. Due to technical restriction, the value will return the price before bundle deal if we don't configure it to 0. Please call GetEscrowDetails if you want to calculate item-level discounted price for bundle deal item.\t"},{"sample":"false","type":"boolean","name":"wholesale","key":"JKeicSc","description":"This value indicates whether buyer buy the order item in wholesale price.\t"},{"sample":"1.0","type":"float","name":"weight","key":"DatWRG","description":"The weight of the item\t"},{"sample":"false","type":"boolean","name":"add_on_deal","key":"dBibzmc","description":"To indicate if this item belongs to an addon deal.\t"},{"sample":"false","type":"boolean","name":"main_item","key":"kYpZAaC","description":"To indicate if this item is main item or sub item. True means main item, false means sub item.\t"},{"sample":"7850296","type":"int","name":"add_on_deal_id","key":"BxHedWF","description":"A unique ID to distinguish groups of items in Cart, and Order. (e.g. AddOnDeal)\t"},{"sample":"flash_sale","type":"string","name":"promotion_type","key":"MGGFtys","description":"Available type：product_promotion, flash_sale, group_by, bundle_deal, add_on_deal_main, add_on_deal_sub, add_on_free_gift_main, add_on_free_gift_sub"},{"sample":"7850297","type":"int","name":"promotion_id","key":"zjNXrQG","description":"The ID of the promotion.\t"},{"sample":"2600144043","type":"int","name":"order_item_id","key":"GZxwADy","description":"The identify of order item. For items in one same bundle deal promotion, the order_item_id should share the same id, such as 1,2. For items not in bundle deal promotion, the order_item_id should be the same as item_id."},{"sample":"7850298","type":"int","name":"promotion_group_id","key":"SixJCBm","description":"The identify of product promotion."},{"description":" Image info of the product.","sample":"","key":"TzbzPGp","type":"object","children":[{"sample":"https://cf.shopee.com.my/file/a9930777e98444e8a55f2d23646b8026_tn","type":"string","name":"image_url","key":"DwnJapM","description":"The image url of the product. Default to be variation image, if the model does not have a variation image, will use an item main image instead."}],"name":"image_info"},{"sample":"[\"IDL\", \"IDG\"]","type":"string[]","name":"product_location_id","key":"JPZtbnE","description":"The list of warehouse IDs of the item."},{"description":"For each item in order, return whether the item is a prescription item or not.","name":"is_prescription_item","sample":"false","type":"boolean","required":null,"key":"tnktrWz"},{"description":"determine if item is B2C_shop_item.","name":"is_b2c_owned_item","sample":"false","type":"boolean","required":null,"key":"XHFjRey"}],"name":"item_list"},{"sample":"1607930885","type":"timestamp","name":"pay_time","key":"SKkhSxw","description":"The time when the order status is updated from UNPAID to PAID. This value is NULL when order is not paid yet.\t"},{"sample":"","type":"string","name":"dropshipper","key":"cPCAntt","description":"For Indonesia orders only. The name of the dropshipper.\t"},{"sample":"","type":"string","name":"dropshipper_phone","key":"NQbGAr","description":"The phone number of dropshipper, could be empty."},{"sample":"false","type":"boolean","name":"split_up","key":"RrSCdTi","description":"To indicate whether this order is split to fullfil order(forder) level. "},{"sample":"Need to Modify Order","type":"string","name":"buyer_cancel_reason","key":"trPHHnZ","description":"Cancel reason from buyer, could be empty."},{"sample":"system","type":"string","name":"cancel_by","key":"SmCNZEF","description":"Could be one of buyer, seller, system or Ops.\t"},{"sample":"BACKEND_LOGISTICS_NOT_STARTED","type":"string","name":"cancel_reason","key":"GBxstJM","description":"Use this field to get reason for buyer, seller, and system cancellation.\t"},{"sample":"false","type":"boolean","name":"actual_shipping_fee_confirmed","key":"pmFEdxs","description":"Use this filed to judge whether the actual_shipping_fee is confirmed.\t"},{"sample":"","type":"string","name":"buyer_cpf_id","key":"FCyDsak","description":"Buyer's CPF number for taxation and invoice purposes. Only for Brazil order.\t"},{"sample":"fulfilled_by_shopee","type":"string","name":"fulfillment_flag","key":"DSCSpGt","description":"Use this field to indicate the order is fulfilled by shopee or seller. Applicable values: fulfilled_by_shopee, fulfilled_by_cb_seller, fulfilled_by_local_seller.\t"},{"sample":"0","type":"timestamp","name":"pickup_done_time","key":"jbTEzFn","description":"The timestamp when pickup is done."},{"description":"The list of package under an order","sample":"","key":"RNQiDjD","type":"object[]","children":[{"sample":"\"61630084074470\"","type":"string","name":"package_number","key":"AbmixMY","description":"Shopee's unique identifier for the package under an order."},{"sample":"LOGISTICS_INVALID","type":"string","name":"logistics_status","key":"fkQkWYB","description":"The Shopee logistics status for the order. Applicable values: See Data Definition-LogisticsStatus."},{"sample":"Standard Delivery","type":"string","name":"shipping_carrier","key":"jSnyXyD","description":"The logistics service provider that the buyer selected for the order to deliver items."},{"description":"The lis of items.","sample":"","key":"fcjrSwn","type":"object[]","children":[{"sample":"2600144043","type":"int","name":"item_id","key":"WkmmJB","description":"Shopee's unique identifier for an item."},{"sample":"0","type":"int","name":"model_id","key":"KXEeYsd","description":"Shopee's unique identifier for a model."},{"description":"The number of identical items purchased at the same time by the same buyer from one listing/item.","name":"model_quantity","sample":"1","type":"int","required":null,"key":"pYaxdSS"}],"name":"item_list"},{"description":"For CB shop, display weight used to calculate actual_shipping_fee for this parcel.","name":"parcel_chargeable_weight_gram","sample":"500","type":"int","required":null,"key":"BNpRxaS"}],"name":"package_list"},{"description":"The invoice data of the order. pt: Nota Fiscal eletrônica (NF-e) do pedido.","sample":"","key":"psbTCXK","type":"object","children":[{"sample":"","type":"string","name":"number","key":"xcBNdzd","description":"The number of the invoice. The number should be 9 digits. pt: número da NF-e."},{"sample":"","type":"string","name":"series_number","key":"ZByaYeC","description":"The series number of the invoice. The series number should be 3 digits. pt: série da NF-e."},{"sample":"","type":"string","name":"access_key","key":"sQdYpCk","description":"The access key of the invoice. The access key should be 44 digits. pt: chave de acesso da NF-e."},{"sample":"","type":"timestamp","name":"issue_date","key":"aYSfHxY","description":"The issue date of the invoice. The issue date should be later than the order pay date. pt: data de emissão da NF-e."},{"sample":"","type":"float","name":"total_value","key":"QxEBKHH","description":"The total value of the invoice. pt: valor total da NF-e (R$)."},{"sample":"","type":"float","name":"products_total_value","key":"JtMbbXX","description":"The products total value of the invoice. pt: valor total dos produtos (R$) da NF-e."},{"sample":"","type":"string","name":"tax_code","key":"ymRyHzB","description":"The tax code for the invoice. The tax code should be 4 digits. pt: Código Fiscal de Operações e Prestações (CFOP) predominante na NF-e. "}],"name":"invoice_data"},{"sample":"Standard Delivery","type":"string","name":"checkout_shipping_carrier","key":"KHiGrc","description":"For non masking order, the logistics service provider that the buyer selected for the order to deliver items. For masking order, the logistics service type that the buyer selected for the order to deliver items."},{"sample":"","type":"float","name":"reverse_shipping_fee","key":"RSGXwTm","description":"Shopee charges the reverse shipping fee for the returned order.The value of this field will be non-negative."},{"description":"For CB shop, display weight used to calculate actual_shipping_fee for this order.","name":"order_chargeable_weight_gram","sample":"500","type":"int","required":null,"key":"KCcPHys"},{"description":"Earliest estimated delivery date of orders (only available for BR region)","name":"edt_from","sample":"","type":"timestamp","required":null,"key":"pHBHjKz"},{"description":"Latest estimated delivery date of orders (only available for BR region)","name":"edt_to","sample":"","type":"timestamp","required":null,"key":"zsyNXN"},{"description":"Return list of all prescription pictures of this order, only for ID whitelist user.","name":"prescription_images","sample":"","type":"string[]","required":null,"key":"KYPebWk"},{"description":"Return prescription check status of this order enum OrderPrescriptionCheckStatus: NONE = 0; PASSED = 1; FAILED = 2; only for ID whitelist user.","name":"prescription_check_status","sample":"","type":"int","required":null,"key":"MSfhWQb"}]
|""".stripMargin
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get order items columns") {
    val json =
      """
[{"treeId":81451,"data":[],"children":[{"treeId":81452,"data":[],"children":[],"name":"pick_up_store_name","id":48,"type":"String","required":false,"desc":"Pick-up Store's name"},{"treeId":81453,"data":[],"children":[],"name":"pick_up_store_address","id":48,"type":"String","required":false,"desc":"Pick-up Store's address"},{"treeId":81454,"data":[],"children":[],"name":"pick_up_store_code","id":48,"type":"String","required":false,"desc":"Pick-up Store's id"},{"treeId":81455,"data":[],"children":[],"name":"pick_up_store_open_hour","id":48,"type":"String[]","required":false,"desc":"Pick-up Store's business hours"}],"name":"pick_up_store_info","id":48,"type":"Object","required":false,"desc":"Pick-up Store infos"},{"treeId":81456,"data":[],"children":[],"name":"purchase_order_number","id":48,"type":"String","required":true,"desc":"Returned when calling SetPackedByMarketPlace"},{"treeId":81457,"data":[],"children":[],"name":"name","id":48,"type":"String","required":true,"desc":"Product name"},{"treeId":81458,"data":[],"children":[],"name":"product_main_image","id":48,"type":"String","required":true,"desc":"Product main image URL"},{"treeId":81459,"data":[],"children":[],"name":"item_price","id":48,"type":"String","required":true,"desc":"Product price"},{"treeId":81460,"data":[],"children":[],"name":"tax_amount","id":48,"type":"String","required":true,"desc":"Tax amount"},{"treeId":81461,"data":[],"children":[],"name":"status","id":48,"type":"String","required":true,"desc":"Status"},{"treeId":81462,"data":[],"children":[],"name":"cancel_return_initiator","id":48,"type":"String","required":false,"desc":"Indicates who initiated the canceled or returned order. Possible values are cancellation-internal, cancellation-customer, cancellation-failed Delivery, cancellation-seller, return-customer, and refund-internal."},{"treeId":81463,"data":[],"children":[],"name":"voucher_platform","id":48,"type":"String","required":false,"desc":"The voucher that is issued by Lazada"},{"treeId":81464,"data":[],"children":[],"name":"voucher_seller","id":48,"type":"String","required":false,"desc":"The voucher that is issued by the seller"},{"treeId":81465,"data":[],"children":[],"name":"order_type","id":48,"type":"String","required":false,"desc":"The type of order，maybe Normal, PreSale, Coupon, O2O or InStoreO2O"},{"treeId":81466,"data":[],"children":[],"name":"stage_pay_status","id":48,"type":"String","required":false,"desc":"The payment status of Presale order at presale stage. The possible values are null, \"unpaid\" or \"unpaid final payment\". (unpaid: presale deposit has not been paid; unpaid final payment: presale deposit is paid but final payment / balance due is not paid)"},{"treeId":81467,"data":[],"children":[],"name":"warehouse_code","id":48,"type":"String","required":false,"desc":"Warehouse Code of multi-wh sellers"},{"treeId":81468,"data":[],"children":[],"name":"voucher_seller_lpi","id":48,"type":"String","required":false,"desc":"The Lazada Bonus that is sponsored by the seller"},{"treeId":81469,"data":[],"children":[],"name":"voucher_platform_lpi","id":48,"type":"String","required":false,"desc":"The Lazada Bonus that is sponsored by Lazada"},{"treeId":81470,"data":[],"children":[],"name":"buyer_id","id":48,"type":"String","required":false,"desc":"Buyer ID"},{"treeId":81471,"data":[],"children":[],"name":"shipping_fee_original","id":48,"type":"String","required":false,"desc":"shipping fee original"},{"treeId":81472,"data":[],"children":[],"name":"shipping_fee_discount_seller","id":48,"type":"String","required":false,"desc":"shipping fee discount from seller"},{"treeId":81473,"data":[],"children":[],"name":"shipping_fee_discount_platform","id":48,"type":"String","required":false,"desc":"shipping fee discount from platform"},{"treeId":81474,"data":[],"children":[],"name":"voucher_code_seller","id":48,"type":"String","required":false,"desc":"voucher code from seller"},{"treeId":81475,"data":[],"children":[],"name":"voucher_code_platform","id":48,"type":"String","required":false,"desc":"voucher code from platform"},{"treeId":81476,"data":[],"children":[],"name":"delivery_option_sof","id":48,"type":"String","required":false,"desc":"The mark of whether is seller own fleet, values included 1 and 0."},{"treeId":81477,"data":[],"children":[],"name":"is_fbl","id":48,"type":"String","required":false,"desc":"The mark of whether is fulfilled by LAZADA, values included 1 and 0."},{"treeId":81478,"data":[],"children":[],"name":"is_reroute","id":48,"type":"String","required":false,"desc":"The mark of whether is secondary sale, values included 1 and 0."},{"treeId":81479,"data":[],"children":[],"name":"reason","id":48,"type":"String","required":true,"desc":"Cancel, Return or other reason, defined in the table sales_order_reason"},{"treeId":81480,"data":[],"children":[],"name":"digital_delivery_info","id":48,"type":"String","required":true,"desc":"Digital deliery information"},{"treeId":81481,"data":[],"children":[],"name":"promised_shipping_time","id":48,"type":"String","required":true,"desc":"Promised shipping time"},{"treeId":81482,"data":[],"children":[],"name":"order_id","id":48,"type":"String","required":true,"desc":"Order ID"},{"treeId":81483,"data":[],"children":[],"name":"voucher_amount","id":48,"type":"String","required":true,"desc":"Voucher amount"},{"treeId":81484,"data":[],"children":[],"name":"return_status","id":48,"type":"String","required":true,"desc":"Return status"},{"treeId":81485,"data":[],"children":[],"name":"shipping_type","id":48,"type":"String","required":true,"desc":"Shipping type, Drop-shipping or Warehouse"},{"treeId":81486,"data":[],"children":[],"name":"shipment_provider","id":48,"type":"String","required":true,"desc":"3PL shipment provider, such as LEX"},{"treeId":81487,"data":[],"children":[],"name":"variation","id":48,"type":"String","required":true,"desc":"Variation"},{"treeId":81488,"data":[],"children":[],"name":"created_at","id":48,"type":"String","required":true,"desc":"Time of the feed's creation in ISO 8601 format"},{"treeId":81489,"data":[],"children":[],"name":"invoice_number","id":48,"type":"String","required":true,"desc":"Invoice number"},{"treeId":81490,"data":[],"children":[],"name":"shipping_amount","id":48,"type":"String","required":true,"desc":"Shipping fee"},{"treeId":81491,"data":[],"children":[],"name":"currency","id":48,"type":"String","required":true,"desc":"ISO 4217 compatible currency code"},{"treeId":81492,"data":[],"children":[],"name":"order_flag","id":48,"type":"String","required":false,"desc":"The type of order, Possible values are GUARANTEE, NORMAL and GLOBAL_COLLECTION. Orders tagged with \"GUARANTEE\" or \"GLOBAL_COLLECTION\" have shorter SLA requirement in order fulfillment."},{"treeId":81493,"data":[],"children":[],"name":"shop_id","id":48,"type":"String","required":true,"desc":"Seller name"},{"treeId":81494,"data":[],"children":[],"name":"sla_time_stamp","id":48,"type":"String","required":false,"desc":"Time of the ship SLA in ISO 8601 format(yyyy-MM-dd'T'HH:mm:ssXXX)"},{"treeId":81495,"data":[],"children":[],"name":"sku","id":48,"type":"String","required":true,"desc":"Product SKU"},{"treeId":81496,"data":[],"children":[],"name":"voucher_code","id":48,"type":"String","required":true,"desc":"Not used"},{"treeId":81497,"data":[],"children":[],"name":"wallet_credits","id":48,"type":"String","required":true,"desc":"Wallet credit"},{"treeId":81498,"data":[],"children":[],"name":"updated_at","id":48,"type":"String","required":true,"desc":"Time of the feed's last update in ISO 8601 format"},{"treeId":81499,"data":[],"children":[],"name":"is_digital","id":48,"type":"Number","required":true,"desc":"Is digital goods or not"},{"treeId":81500,"data":[],"children":[],"name":"tracking_code_pre","id":48,"type":"String","required":true,"desc":"Not used"},{"treeId":81501,"data":[],"children":[],"name":"order_item_id","id":48,"type":"Number","required":true,"desc":"Order item ID"},{"treeId":81502,"data":[],"children":[],"name":"package_id","id":48,"type":"String","required":true,"desc":"Package source ID"},{"treeId":81503,"data":[],"children":[],"name":"tracking_code","id":48,"type":"String","required":true,"desc":"Tracking code retrieved from 3PL shipment provider"},{"treeId":81504,"data":[],"children":[],"name":"shipping_service_cost","id":48,"type":"Number","required":true,"desc":"Shipping service cost"},{"treeId":81505,"data":[],"children":[],"name":"extra_attributes","id":48,"type":"String","required":true,"desc":"JSON encoded string with extra attributes"},{"treeId":81506,"data":[],"children":[],"name":"paid_price","id":48,"type":"String","required":true,"desc":"Paid price"},{"treeId":81507,"data":[],"children":[],"name":"shipping_provider_type","id":48,"type":"String","required":true,"desc":"One of the following options: EXPRESS, STANDARD, ECONOMY, INSTANT, SELLER_OWN_FLEET, PICKUP_IN_STORE or DIGITAL"},{"treeId":81508,"data":[],"children":[],"name":"product_detail_url","id":48,"type":"String","required":true,"desc":"Product detail URL"},{"treeId":81509,"data":[],"children":[],"name":"shop_sku","id":48,"type":"String","required":true,"desc":"Product outer ID"},{"treeId":81510,"data":[],"children":[],"name":"reason_detail","id":48,"type":"String","required":true,"desc":"Reason detail"},{"treeId":81511,"data":[],"children":[],"name":"purchase_order_id","id":48,"type":"String","required":true,"desc":"Returned when calling SetPackedByMarketPlace"},{"treeId":81512,"data":[],"children":[],"name":"sku_id","id":48,"type":"String","required":false,"desc":"Sku ID"},{"treeId":81513,"data":[],"children":[],"name":"product_id","id":48,"type":"String","required":false,"desc":"Product ID"},{"treeId":81514,"data":[],"children":[],"name":"fulfillment_sla","id":48,"type":"String","required":false,"desc":"fulfillment sla info"},{"treeId":81515,"data":[],"children":[],"name":"priority_fulfillment_tag","id":48,"type":"String","required":false,"desc":"priority fulfillment tag"}]|""".stripMargin
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get product columns") {
    val json =
      """[{"treeId":66918,"data":[],"children":[],"name":"primary_category","id":164,"type":"Number","required":false,"desc":"The ID of the primary category for his product."},{"treeId":66919,"data":[],"children":[],"name":"attributes","id":164,"type":"Object","required":false,"desc":"Contains several product attributes. "},{"treeId":66920,"data":[],"children":[],"name":"skus","id":164,"type":"Object[]","required":false,"desc":"An array contains at least one SKU. "},{"treeId":66921,"data":[],"children":[],"name":"item_id","id":164,"type":"Number","required":false,"desc":"The ID of this product"},{"treeId":66922,"data":[],"children":[],"name":"created_time","id":164,"type":"String","required":false,"desc":"create time"},{"treeId":66923,"data":[],"children":[],"name":"updated_time","id":164,"type":"String","required":false,"desc":"update time"},{"treeId":66924,"data":[],"children":[],"name":"images","id":164,"type":"String","required":false,"desc":"product images"},{"treeId":66925,"data":[],"children":[],"name":"marketImages","id":164,"type":"String","required":false,"desc":"product market images"},{"treeId":66926,"data":[],"children":[],"name":"status","id":164,"type":"String","required":false,"desc":"product status"},{"treeId":66927,"data":[],"children":[],"name":"subStatus","id":164,"type":"String","required":false,"desc":"product reject status"},{"treeId":66928,"data":[],"children":[],"name":"suspendedSkus","id":164,"type":"Object[]","required":false,"desc":"An array contains at least one Suspended SKU. "},{"treeId":66929,"data":[],"children":[],"name":"trialProduct","id":164,"type":"Boolean","required":false,"desc":"Whether product is trial product"},{"treeId":66934,"data":[],"children":[],"name":"rejectReason","id":164,"type":"Object[]","required":false,"desc":"rejectReason"}]"""
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get flexi combo columns") {
    val json =
      """
        |[{"treeId":45207,"data":[],"children":[],"name":"order_numbers","id":644,"type":"Number","required":true,"desc":"order_numbers"},{"treeId":45208,"data":[],"children":[],"name":"platform_channel","id":644,"type":"String","required":true,"desc":"platform_channel"},{"treeId":45209,"data":[],"children":[],"name":"name","id":644,"type":"String","required":true,"desc":"name"},{"treeId":45210,"data":[],"children":[{"treeId":45211,"data":[],"children":[],"name":"product_id","id":644,"type":"Number","required":true,"desc":"product_id"},{"treeId":45212,"data":[],"children":[],"name":"sku_id","id":644,"type":"Number","required":true,"desc":"sku_id"}],"name":"gift_skus","id":644,"type":"Object[]","required":true,"desc":"gift_skus"},{"treeId":45213,"data":[],"children":[],"name":"start_time","id":644,"type":"Number","required":true,"desc":"start_time"},{"treeId":45214,"data":[],"children":[],"name":"order_used_numbers","id":644,"type":"Number","required":false,"desc":"orders numbers that has been used in flexi combo"},{"treeId":45215,"data":[],"children":[],"name":"discount_type","id":644,"type":"String","required":true,"desc":"discount_type"},{"treeId":45216,"data":[],"children":[],"name":"end_time","id":644,"type":"Number","required":true,"desc":"end_time"},{"treeId":45217,"data":[],"children":[],"name":"id","id":644,"type":"Number","required":true,"desc":"id"},{"treeId":45218,"data":[],"children":[],"name":"discount_value","id":644,"type":"String[]","required":true,"desc":"discount_value"},{"treeId":45219,"data":[],"children":[],"name":"status","id":644,"type":"String","required":true,"desc":"status"},{"treeId":45220,"data":[],"children":[],"name":"apply","id":644,"type":"String","required":true,"desc":"apply"},{"treeId":45221,"data":[],"children":[{"treeId":45222,"data":[],"children":[],"name":"product_id","id":644,"type":"Number","required":true,"desc":"product_id"},{"treeId":45223,"data":[],"children":[],"name":"sku_id","id":644,"type":"Number","required":true,"desc":"sku_id"}],"name":"sample_skus","id":644,"type":"Object[]","required":true,"desc":"sample_skus"},{"treeId":45224,"data":[],"children":[],"name":"criteria_type","id":644,"type":"String","required":true,"desc":"criteria_type"},{"treeId":45225,"data":[],"children":[],"name":"type","id":644,"type":"String","required":true,"desc":"type"},{"treeId":45226,"data":[],"children":[],"name":"criteria_value","id":644,"type":"String[]","required":true,"desc":"criteria_value"},{"treeId":45228,"data":[],"children":[],"name":"stackable","id":644,"type":"Boolean","required":false,"desc":"Stackable Discount，Ex. Buy 2SGD Save 1SGD, Buy 4SGD Save 2SGD, Buy 6SGD Save 3SGD, etc."}]
        |""".stripMargin
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get payout status columns") {
    val json =
      """[{"treeId":36864,"data":[],"children":[],"name":"closing_balance","id":276,"type":"String","required":false,"desc":"Closing balance"},{"treeId":36865,"data":[],"children":[],"name":"guarantee_deposit","id":276,"type":"String","required":false,"desc":"Guarantee deposit"},{"treeId":36866,"data":[],"children":[],"name":"payout","id":276,"type":"String","required":false,"desc":"Amount to be paid out to seller for statement"},{"treeId":36867,"data":[],"children":[],"name":"paid","id":276,"type":"String","required":false,"desc":"Payout status of statement. 1 is paid, and 0 is not paid"},{"treeId":36851,"data":[],"children":[],"name":"statement_number","id":276,"type":"String","required":false,"desc":"Statement identifier"},{"treeId":36852,"data":[],"children":[],"name":"created_at","id":276,"type":"String","required":false,"desc":"When the statement was created"},{"treeId":36853,"data":[],"children":[],"name":"updated_at","id":276,"type":"String","required":false,"desc":"When the statement was last updated"},{"treeId":36854,"data":[],"children":[],"name":"opening_balance","id":276,"type":"String","required":false,"desc":"The opening balance"},{"treeId":36855,"data":[],"children":[],"name":"item_revenue","id":276,"type":"String","required":false,"desc":"The revenue generated by the item"},{"treeId":36856,"data":[],"children":[],"name":"shipment_fee","id":276,"type":"String","required":false,"desc":"Costs of shipping"},{"treeId":36857,"data":[],"children":[],"name":"shipment_fee_credit","id":276,"type":"String","required":false,"desc":"Shipping fee credit, if any"},{"treeId":36858,"data":[],"children":[],"name":"other_revenue_total","id":276,"type":"String","required":false,"desc":"Other total revenue"},{"treeId":36859,"data":[],"children":[],"name":"fees_total","id":276,"type":"String","required":false,"desc":"Sum of payment fee and return to seller fee"},{"treeId":36860,"data":[],"children":[],"name":"subtotal1","id":276,"type":"String","required":false,"desc":"Sum of item revenue and other revenue"},{"treeId":36861,"data":[],"children":[],"name":"refunds","id":276,"type":"String","required":false,"desc":"Sum of all refunds, if any"},{"treeId":36862,"data":[],"children":[],"name":"fees_on_refunds_total","id":276,"type":"String","required":false,"desc":"Accumulated fees on refunds issued"},{"treeId":36863,"data":[],"children":[],"name":"subtotal2","id":276,"type":"String","required":false,"desc":"(Sum of Subtotal1) - Refunds"}]        |""".stripMargin
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get transaction detail columns") {
    val json = """[{"treeId":48982,"data":[],"children":[],"name":"fee_type","id":128,"type":"String","required":false,"desc":"Transaction type ID."},{"treeId":48983,"data":[],"children":[],"name":"details","id":128,"type":"String","required":false,"desc":"Transaction details"},{"treeId":48984,"data":[],"children":[],"name":"seller_sku","id":128,"type":"String","required":false,"desc":"The seller SKU"},{"treeId":48985,"data":[],"children":[],"name":"lazada_sku","id":128,"type":"String","required":false,"desc":"The Lazada SKU"},{"treeId":48986,"data":[],"children":[],"name":"amount","id":128,"type":"String","required":false,"desc":"Total transaction value"},{"treeId":48987,"data":[],"children":[],"name":"VAT_in_amount","id":128,"type":"String","required":false,"desc":"The VAT in amount"},{"treeId":48988,"data":[],"children":[],"name":"WHT_amount","id":128,"type":"String","required":false,"desc":"The WHT amount"},{"treeId":48989,"data":[],"children":[],"name":"WHT_included_in_amount","id":128,"type":"String","required":false,"desc":"The WHT included in amount or not"},{"treeId":48990,"data":[],"children":[],"name":"statement","id":128,"type":"String","required":false,"desc":"Statement ID"},{"treeId":48991,"data":[],"children":[],"name":"paid_status","id":128,"type":"String","required":false,"desc":"Yes / No"},{"treeId":48992,"data":[],"children":[],"name":"order_no","id":128,"type":"String","required":false,"desc":"Order ID"},{"treeId":48993,"data":[],"children":[],"name":"orderItem_no","id":128,"type":"String","required":false,"desc":"Order item number"},{"treeId":48994,"data":[],"children":[],"name":"orderItem_status","id":128,"type":"String","required":false,"desc":"The order item status"},{"treeId":48995,"data":[],"children":[],"name":"shipping_provider","id":128,"type":"String","required":false,"desc":"The shipping provider"},{"treeId":48996,"data":[],"children":[],"name":"shipping_speed","id":128,"type":"String","required":false,"desc":"The shipping speed"},{"treeId":48997,"data":[],"children":[],"name":"shipment_type","id":128,"type":"String","required":false,"desc":"The shipment type"},{"treeId":48998,"data":[],"children":[],"name":"reference","id":128,"type":"String","required":false,"desc":"The Order Item ID (the Sub-order ID of \"Order ID\" parameter)"},{"treeId":48999,"data":[],"children":[],"name":"comment","id":128,"type":"String","required":false,"desc":"Comments by regional finance team"},{"treeId":49000,"data":[],"children":[],"name":"payment_ref_id","id":128,"type":"String","required":false,"desc":"Payment reference ID from bank or other payment provider"},{"treeId":49001,"data":[],"children":[],"name":"fee_name","id":128,"type":"String","required":false,"desc":"feeName"},{"treeId":49002,"data":[],"children":[],"name":"transaction_date","id":128,"type":"String","required":false,"desc":"Date of the transaction"},{"treeId":49003,"data":[],"children":[],"name":"transaction_type","id":128,"type":"String","required":false,"desc":"Transaction type or fee name"},{"treeId":49004,"data":[],"children":[],"name":"transaction_number","id":128,"type":"String","required":false,"desc":"Unique ID of the transaction in the format \"Seller code- xxxxxxx\""}]"""
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  test("get partner transaction columns") {
    val json = """[{"treeId":77946,"data":[],"children":[],"name":"shipping_fee_original","id":980,"type":"String","required":false,"desc":"the original shipping fee which are supposed to be charged to the customer, before any type of shipping fee promotion"},{"treeId":77947,"data":[],"children":[],"name":"shipping_fee_discount_seller","id":980,"type":"String","required":false,"desc":"shipping fee discount from seller"},{"treeId":77948,"data":[],"children":[],"name":"shipping_fee_discount_platform","id":980,"type":"String","required":false,"desc":"shipping fee discount from platform"},{"treeId":77949,"data":[],"children":[{"treeId":77950,"data":[],"children":[],"name":"address1","id":980,"type":"String","required":false,"desc":"Detailed address"},{"treeId":77951,"data":[],"children":[],"name":"phone2","id":980,"type":"String","required":false,"desc":"Backup phone number"},{"treeId":77952,"data":[],"children":[],"name":"first_name","id":980,"type":"String","required":false,"desc":"Customer first name"},{"treeId":77953,"data":[],"children":[],"name":"phone","id":980,"type":"String","required":false,"desc":"Phone number"},{"treeId":77954,"data":[],"children":[],"name":"address5","id":980,"type":"String","required":false,"desc":"Third-level address"},{"treeId":77955,"data":[],"children":[],"name":"post_code","id":980,"type":"String","required":false,"desc":"Post code; Note: This value will not be used in Lazada ID"},{"treeId":77956,"data":[],"children":[],"name":"address4","id":980,"type":"String","required":false,"desc":"City name"},{"treeId":77957,"data":[],"children":[],"name":"last_name","id":980,"type":"String","required":false,"desc":"Customer last name"},{"treeId":77958,"data":[],"children":[],"name":"country","id":980,"type":"String","required":false,"desc":"country"},{"treeId":77959,"data":[],"children":[],"name":"address3","id":980,"type":"String","required":false,"desc":"State name"},{"treeId":77960,"data":[],"children":[],"name":"address2","id":980,"type":"String","required":false,"desc":"Not used for now"},{"treeId":77961,"data":[],"children":[],"name":"city","id":980,"type":"String","required":false,"desc":"City name"}],"name":"address_shipping","id":980,"type":"Object","required":false,"desc":"Node that contains additional nodes, which makes up the shipping address: FirstName, LastName, Phone, Phone2, Address1, Address2, City, PostCode, and Country."},{"treeId":77962,"data":[],"children":[],"name":"customer_last_name","id":980,"type":"String","required":false,"desc":"Empty for now. See cutomer_first_name."},{"treeId":77963,"data":[],"children":[],"name":"gift_option","id":980,"type":"String","required":false,"desc":"1 if item is a gift, and 0 if it is not."},{"treeId":77964,"data":[],"children":[],"name":"voucher_code","id":980,"type":"String","required":false,"desc":"The returned value is Voucher id"},{"treeId":77965,"data":[],"children":[],"name":"updated_at","id":980,"type":"String","required":false,"desc":"Date and time of the last change to the order."},{"treeId":77966,"data":[],"children":[],"name":"delivery_info","id":980,"type":"String","required":false,"desc":"Delivery information"},{"treeId":77967,"data":[],"children":[],"name":"gift_message","id":980,"type":"String","required":false,"desc":"Gift message as specified by the customer."},{"treeId":77968,"data":[],"children":[{"treeId":77969,"data":[],"children":[],"name":"buyer_id","id":980,"type":"Number","required":false,"desc":"buyer id"},{"treeId":77970,"data":[],"children":[],"name":"partner_user_id","id":980,"type":"String","required":false,"desc":"partnerUser id"},{"treeId":77971,"data":[],"children":[],"name":"seller_id","id":980,"type":"String","required":false,"desc":"seller id"},{"treeId":77972,"data":[],"children":[{"treeId":77973,"data":[],"children":[],"name":"pick_up_store_name","id":980,"type":"String","required":false,"desc":"Pick-up Store's name"},{"treeId":77974,"data":[],"children":[],"name":"pick_up_store_address","id":980,"type":"String","required":false,"desc":"Pick-up Store's address"},{"treeId":77975,"data":[],"children":[],"name":"pick_up_store_code","id":980,"type":"String","required":false,"desc":"Pick-up Store's id"},{"treeId":77976,"data":[],"children":[],"name":"pick_up_store_open_hour","id":980,"type":"String[]","required":false,"desc":"Pick-up Store's business hours"}],"name":"pick_up_store_info","id":980,"type":"Object","required":false,"desc":"Pick-up Store infos"},{"treeId":77977,"data":[],"children":[],"name":"purchase_order_number","id":980,"type":"String","required":false,"desc":"Returned when calling SetPackedByMarketPlace"},{"treeId":77978,"data":[],"children":[],"name":"name","id":980,"type":"String","required":false,"desc":"Product name"},{"treeId":77979,"data":[],"children":[],"name":"product_main_image","id":980,"type":"String","required":false,"desc":"Product main image URL"},{"treeId":77980,"data":[],"children":[],"name":"item_price","id":980,"type":"String","required":false,"desc":"Product price"},{"treeId":77981,"data":[],"children":[],"name":"tax_amount","id":980,"type":"String","required":false,"desc":"Tax amount"},{"treeId":77982,"data":[],"children":[],"name":"status","id":980,"type":"String","required":false,"desc":"canceled"},{"treeId":77983,"data":[],"children":[],"name":"cancel_return_initiator","id":980,"type":"String","required":false,"desc":"cancellation-customer"},{"treeId":77984,"data":[],"children":[],"name":"voucher_platform","id":980,"type":"String","required":false,"desc":"The voucher that is issued by Lazada"},{"treeId":77985,"data":[],"children":[],"name":"voucher_seller","id":980,"type":"String","required":false,"desc":"The voucher that is issued by the seller"},{"treeId":77986,"data":[],"children":[],"name":"order_type","id":980,"type":"String","required":false,"desc":"The type of order，maybe Normal, PreSale, Coupon, O2O or InStoreO2O"},{"treeId":77987,"data":[],"children":[],"name":"stage_pay_status","id":980,"type":"String","required":false,"desc":"The payment status of Presale order at presale stage. The possible values are null, \"unpaid\" or \"unpaid final payment\". (unpaid: presale deposit has not been paid; unpaid final payment: presale deposit is paid but final payment / balance due is not paid)"},{"treeId":77988,"data":[],"children":[],"name":"warehouse_code","id":980,"type":"String","required":false,"desc":"Warehouse Code of multi-wh sellers"},{"treeId":77989,"data":[],"children":[],"name":"voucher_seller_lpi","id":980,"type":"String","required":false,"desc":"The Lazada Bonus that is sponsored by the seller"},{"treeId":77990,"data":[],"children":[],"name":"voucher_platform_lpi","id":980,"type":"String","required":false,"desc":"The Lazada Bonus that is sponsored by Lazada"},{"treeId":77991,"data":[],"children":[],"name":"shipping_fee_original","id":980,"type":"String","required":false,"desc":"shipping fee original"},{"treeId":77992,"data":[],"children":[],"name":"shipping_fee_discount_seller","id":980,"type":"String","required":false,"desc":"shipping fee discount from seller"},{"treeId":77993,"data":[],"children":[],"name":"shipping_fee_discount_platform","id":980,"type":"String","required":false,"desc":"shipping fee discount from platform"},{"treeId":77994,"data":[],"children":[],"name":"voucher_code_seller","id":980,"type":"String","required":false,"desc":"voucher code from seller"},{"treeId":77995,"data":[],"children":[],"name":"voucher_code_platform","id":980,"type":"String","required":false,"desc":"voucher code from platform"},{"treeId":77996,"data":[],"children":[],"name":"is_fbl","id":980,"type":"Number","required":false,"desc":"The mark of whether is fulfilled by LAZADA, values included 1 and 0."},{"treeId":77997,"data":[],"children":[],"name":"is_reroute","id":980,"type":"Number","required":false,"desc":"The mark of whether is secondary sale, values included 1 and 0."},{"treeId":77998,"data":[],"children":[],"name":"reason","id":980,"type":"String","required":false,"desc":"Cancel, Return or other reason, defined in the table sales_order_reason"},{"treeId":77999,"data":[],"children":[],"name":"digital_delivery_info","id":980,"type":"String","required":false,"desc":"Digital deliery information"},{"treeId":78000,"data":[],"children":[],"name":"promised_shipping_time","id":980,"type":"String","required":false,"desc":"Promised shipping time"},{"treeId":78001,"data":[],"children":[],"name":"order_id","id":980,"type":"Number","required":false,"desc":"order id"},{"treeId":78002,"data":[],"children":[],"name":"voucher_amount","id":980,"type":"String","required":false,"desc":"Voucher amount"},{"treeId":78003,"data":[],"children":[],"name":"return_status","id":980,"type":"String","required":false,"desc":"Return status"},{"treeId":78004,"data":[],"children":[],"name":"shipping_type","id":980,"type":"String","required":false,"desc":"Shipping type, Drop-shipping or Warehouse"},{"treeId":78005,"data":[],"children":[],"name":"shipment_provider","id":980,"type":"String","required":false,"desc":"3PL shipment provider, such as LEX"},{"treeId":78006,"data":[],"children":[],"name":"variation","id":980,"type":"String","required":false,"desc":"variation"},{"treeId":78007,"data":[],"children":[],"name":"created_at","id":980,"type":"String","required":false,"desc":"Time of the feed's creation in ISO 8601 format"},{"treeId":78008,"data":[],"children":[],"name":"invoice_number","id":980,"type":"String","required":false,"desc":"Invoice number"},{"treeId":78009,"data":[],"children":[],"name":"shipping_amount","id":980,"type":"String","required":false,"desc":"Shipping fee"},{"treeId":78010,"data":[],"children":[],"name":"currency","id":980,"type":"String","required":false,"desc":"SGD"},{"treeId":78011,"data":[],"children":[],"name":"order_flag","id":980,"type":"String","required":false,"desc":"The type of order, Possible values are GUARANTEE, NORMAL and GLOBAL_COLLECTION. Orders tagged with \"GUARANTEE\" or \"GLOBAL_COLLECTION\" have shorter SLA requirement in order fulfillment."},{"treeId":78012,"data":[],"children":[],"name":"shop_id","id":980,"type":"String","required":false,"desc":"dawen dp"},{"treeId":78013,"data":[],"children":[],"name":"sla_time_stamp","id":980,"type":"String","required":false,"desc":"Time of the ship SLA in ISO 8601 format(yyyy-MM-dd'T'HH:mm:ssXXX)"},{"treeId":78014,"data":[],"children":[],"name":"sku","id":980,"type":"String","required":false,"desc":"Product SKU"},{"treeId":78015,"data":[],"children":[],"name":"voucher_code","id":980,"type":"String","required":false,"desc":"Not used"},{"treeId":78016,"data":[],"children":[],"name":"wallet_credits","id":980,"type":"String","required":false,"desc":"Wallet credit"},{"treeId":78017,"data":[],"children":[],"name":"updated_at","id":980,"type":"String","required":false,"desc":"Time of the feed's last update in ISO 8601 format"},{"treeId":78018,"data":[],"children":[],"name":"is_digital","id":980,"type":"Number","required":false,"desc":"Is digital goods or not"},{"treeId":78019,"data":[],"children":[],"name":"tracking_code_pre","id":980,"type":"String","required":false,"desc":"Not used"},{"treeId":78020,"data":[],"children":[],"name":"order_item_id","id":980,"type":"Number","required":false,"desc":"Order item ID"},{"treeId":78021,"data":[],"children":[],"name":"package_id","id":980,"type":"String","required":false,"desc":"Package source ID"},{"treeId":78022,"data":[],"children":[],"name":"tracking_code","id":980,"type":"String","required":false,"desc":"Tracking code retrieved from 3PL shipment provider"},{"treeId":78023,"data":[],"children":[],"name":"shipping_service_cost","id":980,"type":"String","required":false,"desc":"Shipping service cost"},{"treeId":78024,"data":[],"children":[],"name":"extra_attributes","id":980,"type":"String","required":false,"desc":"JSON encoded string with extra attributes"},{"treeId":78025,"data":[],"children":[],"name":"paid_price","id":980,"type":"String","required":false,"desc":"Paid price"},{"treeId":78026,"data":[],"children":[],"name":"shipping_provider_type","id":980,"type":"String","required":false,"desc":"One of the following options: EXPRESS, STANDARD, ECONOMY, INSTANT, SELLER_OWN_FLEET, PICKUP_IN_STORE or DIGITAL"},{"treeId":78027,"data":[],"children":[],"name":"product_detail_url","id":980,"type":"String","required":false,"desc":"Product detail URL"},{"treeId":78028,"data":[],"children":[],"name":"shop_sku","id":980,"type":"String","required":false,"desc":"Product outer ID"},{"treeId":78029,"data":[],"children":[],"name":"reason_detail","id":980,"type":"String","required":false,"desc":"Reason detail"},{"treeId":78030,"data":[],"children":[],"name":"purchase_order_id","id":980,"type":"String","required":false,"desc":"Returned when calling SetPackedByMarketPlace"},{"treeId":78031,"data":[],"children":[],"name":"sku_id","id":980,"type":"String","required":false,"desc":"Sku Id"},{"treeId":78032,"data":[],"children":[],"name":"product_id","id":980,"type":"String","required":false,"desc":"Product ID"}],"name":"member_sub_order_list","id":980,"type":"Object[]","required":false,"desc":"the membership info and subOrder info"},{"treeId":77755,"data":[],"children":[],"name":"branch_number","id":980,"type":"String","required":false,"desc":"(For Thailand only) The tax branch code for corporate customers, provided by the customer when placing the order."},{"treeId":77756,"data":[],"children":[],"name":"tax_code","id":980,"type":"String","required":false,"desc":"(For Thailand and Vietnam only) The customer's VAT tax code, provided by the customer when placing the order."},{"treeId":77757,"data":[],"children":[],"name":"extra_attributes","id":980,"type":"String","required":false,"desc":"Extra attributes which were passed to the Seller Center on getMarketPlaceOrders call."},{"treeId":77758,"data":[],"children":[],"name":"address_updated_at","id":980,"type":"String","required":false,"desc":"Address updated at"},{"treeId":77759,"data":[],"children":[],"name":"shipping_fee","id":980,"type":"String","required":false,"desc":"Total shipping fee for this order."},{"treeId":77760,"data":[],"children":[],"name":"customer_first_name","id":980,"type":"String","required":false,"desc":"Customer first name"},{"treeId":77761,"data":[],"children":[],"name":"payment_method","id":980,"type":"String","required":false,"desc":"The method of the payment. "},{"treeId":77762,"data":[],"children":[],"name":"statuses","id":980,"type":"String[]","required":false,"desc":"An array of unique status of the items in the order. You can find all of the different status codes in the response example."},{"treeId":77763,"data":[],"children":[],"name":"remarks","id":980,"type":"String","required":false,"desc":"Remarks"},{"treeId":77764,"data":[],"children":[],"name":"order_number","id":980,"type":"Number","required":false,"desc":"Represents the order ID"},{"treeId":77765,"data":[],"children":[],"name":"order_id","id":980,"type":"Number","required":false,"desc":"Represents the order ID"},{"treeId":77766,"data":[],"children":[],"name":"voucher","id":980,"type":"String","required":false,"desc":"Total voucher for this order."},{"treeId":77767,"data":[],"children":[],"name":"national_registration_number","id":980,"type":"String","required":false,"desc":"National registration number. Required in some countries."},{"treeId":77768,"data":[],"children":[],"name":"promised_shipping_times","id":980,"type":"String","required":false,"desc":"Target shipping time for the soonest order item if they are available."},{"treeId":77769,"data":[],"children":[],"name":"items_count","id":980,"type":"Number","required":false,"desc":"Number of items in order."},{"treeId":77770,"data":[],"children":[],"name":"voucher_platform","id":980,"type":"String","required":false,"desc":"The voucher that is issued by Lazada"},{"treeId":77771,"data":[],"children":[],"name":"voucher_seller","id":980,"type":"String","required":false,"desc":"The voucher that is issued by the seller"},{"treeId":77772,"data":[],"children":[],"name":"created_at","id":980,"type":"String","required":false,"desc":"Date and time when the order was placed."},{"treeId":77773,"data":[],"children":[],"name":"price","id":980,"type":"String","required":false,"desc":"Total amount for this order.Not the final transaction price of the order, excluding voucher and shipping_fee"},{"treeId":77774,"data":[],"children":[{"treeId":77934,"data":[],"children":[],"name":"address1","id":980,"type":"String","required":false,"desc":"Detailed address"},{"treeId":77935,"data":[],"children":[],"name":"phone2","id":980,"type":"String","required":false,"desc":"Backup phone number"},{"treeId":77936,"data":[],"children":[],"name":"first_name","id":980,"type":"String","required":false,"desc":"Customer first name"},{"treeId":77937,"data":[],"children":[],"name":"phone","id":980,"type":"String","required":false,"desc":"Phone number"},{"treeId":77938,"data":[],"children":[],"name":"address5","id":980,"type":"String","required":false,"desc":"Third-level address"},{"treeId":77939,"data":[],"children":[],"name":"post_code","id":980,"type":"String","required":false,"desc":"Post code; Note: This value will not be used in Lazada ID"},{"treeId":77940,"data":[],"children":[],"name":"address4","id":980,"type":"String","required":false,"desc":"City name"},{"treeId":77941,"data":[],"children":[],"name":"last_name","id":980,"type":"String","required":false,"desc":"Customer last name"},{"treeId":77942,"data":[],"children":[],"name":"country","id":980,"type":"String","required":false,"desc":"country"},{"treeId":77943,"data":[],"children":[],"name":"address3","id":980,"type":"String","required":false,"desc":"State name"},{"treeId":77944,"data":[],"children":[],"name":"address2","id":980,"type":"String","required":false,"desc":"Not used for now"},{"treeId":77945,"data":[],"children":[],"name":"city","id":980,"type":"String","required":false,"desc":"City name"}],"name":"address_billing","id":980,"type":"Object","required":false,"desc":"Node that contains additional nodes, which makes up the billing address: FirstName, LastName, Phone, Phone2, Address1, Address2, City, PostCode, and Country."},{"treeId":77775,"data":[],"children":[],"name":"warehouse_code","id":980,"type":"String","required":false,"desc":"Warehouse Code of multi-wh sellers"}]"""
    val columns: Array[Column] = toColumns(json).toArray
    println(util.JsonUtils.toJson(columns))
  }

  private def toColumns(json: String): Seq[Column] = {
    val jsonNodeList = util.JsonUtils.fromJson[Seq[JsonNode]](json)
    val columnAsJsonList: Seq[String] = jsonNodeList.flatMap { jsonNode =>
      {
        val `type` = jsonNode.get("type").asText()
        val description = jsonNode.get("desc").asText()
        val name = jsonNode.get("name").asText()
        val children = jsonNode.get("children")
        toColumnJsonList(name, `type`, description, children)

      }
    }
    val columnsAsJson: String =
      s"""[
         | ${columnAsJsonList.mkString(", ")}
         |]""".stripMargin
    util.JsonUtils.fromJson[Seq[Column]](columnsAsJson)
  }

  private def toColumnJsonList(name: String, `type`: String, description: String, children: JsonNode): Seq[String] = {
    if (String.valueOf(`type`).toLowerCase == "object") {
      val jsonNodeList: Seq[JsonNode] = children.elements().asScala.toList
      val columnAsJsonList: Seq[String] = jsonNodeList.flatMap { jsonNode =>
        {
          val `type` = jsonNode.get("type").asText()
          val description = jsonNode.get("desc").asText()
          val childName = jsonNode.get("name").asText()
          val children = jsonNode.get("children")
          toColumnJsonList(s"${name}.${childName}", `type`, description, children)
        }
      }
      columnAsJsonList
    } else {
      val columnAsJson =
        s"""{
           | "class_name": "${getClassName(`type`, name)}",
           | "description": "${String.valueOf(description).replaceAll("\"", "'").trim()}",
           | "name": "${String.valueOf(name).trim}",
           | "display_name": "${String.valueOf(name).trim}",
           | "is_nullable": true,
           | "is_encrypted": false
           |}""".stripMargin
      Seq(columnAsJson)
    }
  }

  private def getClassName(`type`: String, name: String): String = {
    if (name.contains("updated_at") || name.contains("created_at")) {
      return "datetime"
    }
    String.valueOf(`type`).toLowerCase match {
      case "string"    => "string"
      case "number"    => "int64"
      case "int"       => "int32"
      case "float"     => "double"
      case "timestamp" => "int64"
      case "boolean"   => "bool"
      case "object[]"  => "string"
      case "string[]"  => "string"
      case _           => throw InternalError(s"Unknown type: ${`type`}")
    }
  }

  test("parse string to datetime using iso 8601 format") {
    val text = "2018-02-09T22:44:30+08:00"
    val date = LazadaReader.DEFAULT_FORMATTER.parse(text)
    val dateAsText = LazadaReader.DEFAULT_FORMATTER.format(date)
    assert(dateAsText == "2018-02-09T14:44:30Z")
  }

  test("parse string to datetime using iso 8601 format 2") {
    val text = "2018-02-09T22:44:30+07:00"
    val date = LazadaReader.DEFAULT_FORMATTER.parse(text)
    val dateAsText = LazadaReader.DEFAULT_FORMATTER.format(date)
    assert(dateAsText == "2018-02-09T15:44:30Z")
  }

}
